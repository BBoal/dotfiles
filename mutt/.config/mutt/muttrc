set ssl_starttls=yes
set ssl_force_tls=yes

set imap_user = 'abinsimon10@gmail.com'
set imap_pass = $GOOGLE_PASSWORD

set from='abinsimon10@gmail.com'
set realname='Abin Simon'

set folder = $HOME/.local/share/mail/meain/
set spoolfile = +INBOX
set postponed=+[Gmail]/Drafts

set header_cache = "~/.mutt/cache/headers"
set message_cachedir = "~/.mutt/cache/bodies"
set certificate_file = "~/.mutt/certificates"

set smtp_url = "smtp://abinsimon10@smtp.gmail.com:587/"
set smtp_pass=$GOOGLE_PASSWORD

set move = no
set imap_keepalive = 900

source muttcol

set autoedit = yes
set sleep_time = 0
set sort = 'threads'
set sort_aux = 'reverse-last-date-received'
set editor = $EDITOR
set mailcap_path = $HOME/.config/mutt/mailcap
set signature = $HOME/.config/mutt/signature
set query_command = "$HOME/.bin/mailcomplete '%s'"

timeout-hook 'exec sync-mailbox'
shutdown-hook '`/Users/meain/.bin/mailsync > /dev/null 2>&1 &`'

# set date_format="%m/%d %I:%M"
# set index_format="%2C %?X?A& ? %D %-15.15F %s (%-4.4c)"
set date_format="%b %d"
set index_format="%?X?A& ? %D %-15.15F %s (%-4.4c)"

set forward_format = "Fwd: %s"
set markers = no
set mark_old = no
set mime_forward = yes
set smtp_authenticators = 'gssapi:login'
set edit_headers
auto_view text/html
auto_view application/pdf
alternative_order text/plain text/enriched text/html

# General remappings
bind index,pager g noop
bind index,pager gg noop

bind editor <space> noop
bind index G last-entry
bind index gg first-entry
bind pager j next-line
bind pager k previous-line
bind attach,index,pager \CD next-page
bind attach,index,pager \CU previous-page
bind pager gg top
bind pager G bottom
bind index D delete-message
bind index U undelete-message
bind index,pager R group-reply
bind index <Tab> collapse-all
macro index,pager \Cu |urlview\n
bind editor <Tab> complete-query
bind editor ^T complete
macro index,pager h "<view-attachments>/text/html<enter><enter>q" "open html version"

# Sidebar mappings
set sidebar_visible = yes
set sidebar_width = 20
set sidebar_short_path = yes
set sidebar_next_new_wrap = yes
set mail_check_stats
set sidebar_format = '%B%?F? [%F]?%* %?N?%N/? %?S?%S?'
bind index <up> sidebar-prev   # got to previous folder in sidebar
bind index <down> sidebar-next  # got to next folder in sidebar
bind index <space> sidebar-open  # open selected folder from sidebar
bind index,pager B sidebar-toggle-visible
bind compose R rename-attachment

bind index u toggle-new
unmailboxes *
# mailboxes =INBOX =[Gmail].Drafts =Archive =[Gmail].Sent Mail 
mailboxes =INBOX

# https://notmuchmail.org/mutttips/
set nm_default_uri="notmuch://$HOME/.local/share/mail
set virtual_spoolfile=yes  # enable virtual folders
virtual-mailboxes \
        "inbox"         "notmuch://?query=folder:/INBOX/ and -tag:bullshit and -tag:known and -tag:newsletter and -tag:nonimportant and -tag:python"\
        "focused"       "notmuch://?query=folder:/INBOX/ and -tag:bullshit and -tag:known and -tag:newsletter and -tag:nonimportant and -tag:python and -tag:github"\
        "github"        "notmuch://?query=folder:/INBOX/ and tag:github"\
        "python"        "notmuch://?query=folder:/INBOX/ and tag:python"\
        "newsletter"    "notmuch://?query=folder:/INBOX/ and tag:newsletter"\
        "bullshit"      "notmuch://?query=folder:/INBOX/ and tag:bullshit"\
        "known"         "notmuch://?query=folder:/INBOX/ and tag:known"\
        "nonimportant"  "notmuch://?query=folder:/INBOX/ and tag:nonimportant"\
        "archiveable"   "notmuch://?query=folder:/INBOX/ and tag:bullshit tag:known tag:nonimportant"\

macro index,pager gs "<change-folder>=[Gmail].Sent Mail<enter>" "Go to sent."
macro index,pager gd "<change-folder>=[Gmail].Drafts<enter>" "Go to drafts."
macro index,pager gt "<change-folder>=[Gmail].Trash<enter>" "Go to trash."
macro index,pager gS "<change-folder>=[Gmail].Spam<enter>" "Go to spam."
macro index,pager ga "<change-folder>=Archive<enter>" "Go to archive."
macro index,pager a ":set confirmappend=no\n<save-message>=Archive<enter>" "Archived Message"

# https://raw.githubusercontent.com/karelzak/mutt-kz/master/README.notmuch
macro index \\\\ "<vfolder-from-query>"  # looks up a hand made query
macro index,pager gi "<change-vfolder>inbox<enter>" "Go to regular inbox."
macro index,pager gf "<change-vfolder>fullinbox<enter>" "Go to inbox with everything."
macro index,pager gn "<change-vfolder>newsletter<enter>" "Go to newsletter."
macro index,pager gb "<change-vfolder>bullshit<enter>" "Go to bullshit."
macro index,pager gk "<change-vfolder>known<enter>" "Go to known."

set spoolfile = "+INBOX"
set record = "+[Gmail].Sent Mail"
set postponed = "+[Gmail].Drafts"
