#!/bin/sh

set -e

RFILE="resources"

if [ "$1" = "new" ]; then
    cd ~/.notes/resources
    printf "Name: "
    read -r
    RFILE="$(echo "$REPLY" | tr ' ' '-')"
    touch "$RFILE"
    exit
else
    if [ ! -f "$RFILE" ]; then
        cd ~/.notes/resources
        RFILE=$(command ls -t1 | fzf)
    fi
fi

[ "$1" = l ] && cat "$RFILE" && exit 0
[ "$1" = 'list' ] && cat "$RFILE" && exit 0
[ "$1" = o ] && fzf -m <"$RFILE" | awk '{print $1}' | xargs -L1 -I{} open "{}" && exit 0

if echo "$1" | grep -qE "^http";then
    LINK="$1"
elif  echo "$(pbpaste)" | grep -qE "^http";then
    LINK="$(pbpaste)"
else
    echo "No link passed or found in clipboard" && exit 1
fi
grep -q "^$LINK" "$RFILE" && echo "$(tput setaf 1)[Already available]$(tput sgr0) $(pbpaste)" && exit 1
echo "$RFILE < $(pbpaste)"
printf "Comments(empty for none): "
read -r
if [ -n "$REPLY" ];then
    echo "$(pbpaste) '$REPLY'" >>"$RFILE"
else
    echo "$(pbpaste)" >>"$RFILE" # echo is kept is so that it inserts a newline
fi
