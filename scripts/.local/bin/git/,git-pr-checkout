#!/bin/sh

# Checking a pr using hub

set -e

# hub pr checkout "$(hub pr list | sed 's/^\ *//' | fzf | sed 's/.\([0-9]*\).*/\1/')"
prd="$(gh pr list|fzf)"
[ -z "$prd" ] && echo "No PR selected" && exit 0

echo "$prd"
pr="$(echo "$prd"|awk '{print $1}')"
prb="$(echo "$prd"|awk '{print $(NF-1)}'|cut -d':' -f2)"

printf "Branch name(%s): " "$prb" && read -r
branch="$REPLY"
[ -z "$branch" ] && branch="$prb"
upstream="upstream"

echo Checking out "$pr" as "$branch"
git remote | grep -q upstream || upstream="origin"
git fetch $upstream pull/$pr/head:$branch
git checkout $branch
